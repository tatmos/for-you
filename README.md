# Meaning-space Surfing（Webプロトタイプ）

Three.js + Viteで、高次元意味空間を漂うように探索するインタラクティブな可視化プロトタイプです。ノードは概念、エッジは関連度、フロー場がドリフト移動を緩やかに誘導します。

## 特徴

### コアビジュアライゼーション
- 決定論的なグラフ生成（約300ノード + 重み付きエッジ）
- カスタムシェーダーによる美しい点群レンダリング
  - 距離ベースのフェード
  - 微細な時間ベースの輝度変化（トゥインクル）
- ホバーで近傍をハイライトし、ラベルを表示
- ドリフトモード（スペースキー）でフロー場に沿って移動

### スカラーフィールドシステム
- **Coherence（コヒーレンス）**: ノード間の方向の一貫性を表す
- **Entropy（エントロピー）**: 無秩序さを表す（1 - coherence）
- **FlowStrength（フロー強度）**: 局所的なベクトル場の強さ

### 適応的ビジュアルフィードバック
- **ストリームライン可視化**: ベクトル場統合による流線表示
  - コヒーレントな領域では長く明るい流線（非線形強調）
  - 拡散領域では短く淡い流線
  - flowStrengthとcoherenceを組み合わせた長さ決定
  - **Hero Streamlines**: ドリフト時、カメラ前方に「道」を示す主流線（5本）
- **3層深度レンダリング**: 星雲のような奥行き表現
  - Near層: シャープで明瞭
  - Mid層: ソフトでなめらか
  - Far層: 霧に溶け込む（霧色とブレンド）
- **ダイナミックブルームエフェクト**: Unreal Bloom Pass
  - 非線形カーブ（smoothstep、二乗）で自然な変化
  - 白飛び防止設計（threshold 0.74-0.92）
  - 高コヒーレンス時も「気配」として機能
- **適応的フォグ**: コヒーレンスに応じて視界距離が変化
- **エッジ透明度**: 非線形（二乗）コヒーレンスで動的調整

## ローカル実行

```bash
npm install
npm run dev
```

起動後、表示されたViteのローカルURLをブラウザで開いてください。

## 操作
- **ドラッグ**: オービット
- **スクロール**: ズーム
- **Space**: ドリフト切り替え
- **M**: メトリクス表示/非表示（開発用）
- **ホバー**: ノードと近傍をハイライト

## 体験のポイント
- ドリフトをONにすると：
  - 前方に「道」（Hero Streamlines）が現れ、進むべき方向を示します
  - コヒーレント領域で視界が「クリアアップ」し、流線が束になります
  - 空間が「澄む」感覚を、bloom/fog/edges/streamlinesの総合で表現
- 拡散領域では：
  - フォグが濃く、エッジが薄暗く、ブルームが抑えられます
  - 流線は短く淡くなり、空間が「霞む」
- ズームアウトすると：
  - 点群が「霧に溶ける」星雲のような3層表現
  - 奥行きが情報の層として視覚化されます
- カメラ位置のスカラーフィールド値に応じて、シーン全体の雰囲気が有機的に変化します

## パフォーマンス最適化
- **Streamline色更新**: 60fps → 10fpsに間引き（6倍軽量化）
- **Baked Fields**: セグメント毎のスカラーフィールドを事前計算
- **条件付き更新**: Hero Streamlinesはカメラ移動時のみ再生成
- 結果: 約300ノード + 200ストリームライン + 5 Hero Streamlinesで滑らかな動作

## アーキテクチャ
- **ParamBus** (`src/metrics/paramBus.ts`): 全ビジュアルパラメータの中央管理
  - 将来の音響統合の接続ポイント
  - coherence, entropy, flowStrength, alignment, driftEnabledを一元提供
  - postprocess / fog / edges / streamlines が統一インターフェースで参照

## デプロイ（GitHub Pages）

このリポジトリには `.github/workflows/deploy.yml` のGitHub Actionsワークフローが含まれており、`main` ブランチへのpush時にViteアプリをビルドして `dist/` をGitHub Pagesへ公開します。

GitHub Pagesのサブパス（`/<リポジトリ名>/`）で404にならないように、ワークフロー側で `BASE_PATH` を自動設定しています。

`<owner>.github.io` のユーザ/組織ページとして公開する場合はルート配信になるため、`BASE_PATH` は `/` になります。
